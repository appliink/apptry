<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BoxWin - Unbox the Best Deals</title>
  <meta name="description" content="BoxWin - curated affiliate deals. Search products, filter by category, and buy via affiliate links.">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#667eea;--bg2:#764ba2;
      --accent1:#ff6b6b;--accent2:#4ecdc4;
      --surface:#fff;--muted:#6b7280;--text:#111827;
      --glass:rgba(255,255,255,0.85);
      --radius-lg:24px;--radius-md:12px;--maxw:1200px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{
      background:linear-gradient(135deg,var(--bg1),var(--bg2),#f093fb);
      color:var(--text);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
      min-height:100%;
    }

    header.site-header{
      position:sticky;top:0;z-index:60;
      background:linear-gradient(180deg,rgba(255,255,255,0.9),rgba(255,255,255,0.85));
      backdrop-filter:blur(10px);
      border-bottom:1px solid rgba(0,0,0,0.06);
    }
    .nav{
      max-width:var(--maxw);margin:0 auto;padding:12px 20px;
      display:flex;align-items:center;gap:16px;flex-wrap:wrap;
    }
    .brand{display:flex;gap:12px;align-items:center;text-decoration:none;color:inherit}
    .logo-icon{
      width:44px;height:44px;border-radius:12px;display:grid;place-items:center;
      background:linear-gradient(135deg,var(--accent1),var(--accent2));
      color:white;font-weight:900;font-size:20px;box-shadow:0 6px 22px rgba(0,0,0,0.15);
    }
    .brand h1{
      font-size:20px;margin:0;font-weight:800;
      background:linear-gradient(135deg,var(--accent1),var(--accent2));
      -webkit-background-clip:text;color:transparent;
    }
    .search-wrap{flex:1;min-width:240px;max-width:640px;position:relative}
    .search-input{
      width:100%;padding:12px 48px;border-radius:999px;border:1px solid rgba(0,0,0,0.06);
      background:var(--surface);font-size:15px;box-shadow:0 6px 20px rgba(2,6,23,0.08);
      outline:none;transition:box-shadow .18s,border-color .18s;
    }
    .search-input:focus{box-shadow:0 10px 30px rgba(2,6,23,0.12);border-color:var(--accent1)}
    .search-icon{position:absolute;left:16px;top:50%;transform:translateY(-50%);font-size:16px;color:var(--muted)}
    .nav-actions{display:flex;gap:10px;align-items:center;flex-shrink:0}
    .cta-btn{
      background:linear-gradient(135deg,var(--accent1),var(--accent2));
      color:white;border:none;padding:10px 18px;border-radius:999px;
      font-weight:700;cursor:pointer;box-shadow:0 8px 25px rgba(255,107,107,0.25);
    }
    .hamburger{
      width:44px;height:44px;border-radius:10px;display:grid;place-items:center;
      background:var(--surface);border:1px solid rgba(0,0,0,0.04);cursor:pointer;
    }

    main{max-width:var(--maxw);margin:28px auto;padding:0 20px 80px;display:grid;gap:28px}
    .hero{
      display:flex;flex-direction:column;gap:18px;padding:36px;border-radius:var(--radius-lg);
      background:linear-gradient(180deg,rgba(255,255,255,0.04),rgba(255,255,255,0.02));
      backdrop-filter:blur(6px);
    }
    .hero h2{margin:0;font-size:40px;color:white;line-height:1.05;font-weight:900}
    .hero p{margin:0;color:rgba(255,255,255,0.9);font-size:16px}
    .hero .actions{display:flex;flex-wrap:wrap;gap:12px;align-items:center;margin-top:6px}

    .categories-drawer{
      position:fixed;top:84px;right:20px;z-index:80;width:320px;max-width:85vw;padding:18px;border-radius:16px;
      background:linear-gradient(180deg,var(--glass),rgba(255,255,255,0.75));
      box-shadow:0 12px 45px rgba(15,23,42,0.2);
      transform:translateY(-10px);opacity:0;pointer-events:none;
      transition:all .22s ease;border:1px solid rgba(0,0,0,0.06);
    }
    .categories-drawer.open{transform:translateY(0);opacity:1;pointer-events:auto}
    .categories-grid{display:flex;flex-wrap:wrap;gap:10px}
    .cat-btn{padding:8px 12px;border-radius:999px;background:white;border:1px solid rgba(0,0,0,0.06);cursor:pointer;font-weight:600}

    .products-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px}
    .product-card{
      background:var(--surface);border-radius:16px;padding:14px;
      border:1px solid rgba(2,6,23,0.04);box-shadow:0 12px 30px rgba(2,6,23,0.05);
      display:flex;flex-direction:column;gap:10px;
    }
    .product-card img{width:100%;height:160px;object-fit:cover;border-radius:12px}
    .product-meta{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .product-title{font-weight:800;margin:0;font-size:16px}
    .product-desc{margin:0;color:var(--muted);font-size:13px}
    .product-actions{display:flex;gap:8px;align-items:center;margin-top:6px;flex-wrap:wrap}
    .btn{padding:8px 12px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);cursor:pointer;background:#fff;font-weight:700}
    .btn-primary{background:linear-gradient(135deg,var(--accent1),var(--accent2));color:white;border:none}
    .results-head{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .muted{color:var(--muted)}
    footer{max-width:var(--maxw);margin:0 auto;padding:40px 20px 80px;color:white;text-align:center}
    footer .small{opacity:0.8;font-size:14px;margin-top:8px}

    /* --- Responsive tweaks --- */
    @media (max-width:900px){
      .nav{padding:10px 14px;gap:10px}
      .brand h1{font-size:18px}
      .search-wrap{order:3;width:100%}
      .hero h2{font-size:28px}
      .cta-btn{padding:8px 14px;font-size:14px}
      .categories-drawer{top:74px;right:10px;left:10px;width:auto}
    }
    @media (max-width:600px){
      .hero{padding:22px}
      .hero h2{font-size:24px}
      .hero p{font-size:14px}
      .product-card img{height:140px}
      .product-title{font-size:15px}
      .nav{flex-direction:row;flex-wrap:wrap}
      .brand{flex:1 0 100%;justify-content:center}
      .nav-actions{flex:1 0 100%;justify-content:center}
    }
  </style>
</head>
<body>
  <!-- Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† HTML Ùˆ JavaScript Ø¨Ø¯ÙˆÙ† Ø£ÙŠ ØªØ¹Ø¯ÙŠÙ„ -->
  <!-- Ø§Ù„ØµÙ‚ ÙÙ‚Ø· ÙƒÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù‡Ù†Ø§ ÙƒÙ…Ø§ Ù‡Ùˆ -->
  <!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BoxWin - Unbox the Best Deals</title>
  <meta name="description" content="BoxWin - curated affiliate deals. Search products, filter by category, and buy via affiliate links.">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1: #667eea;
      --bg2: #764ba2;
      --accent1: #ff6b6b;
      --accent2: #4ecdc4;
      --surface: #ffffff;
      --muted: #6b7280;
      --text: #111827;
      --glass: rgba(255,255,255,0.85);
      --radius-lg: 24px;
      --radius-md: 12px;
      --maxw: 1200px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{
      background: linear-gradient(135deg,var(--bg1) 0%, var(--bg2) 50%, #f093fb 100%);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      min-height:100%;
    }

    /* Header */
    header.site-header{
      position:sticky;top:0;z-index:60;
      background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.85));
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0,0,0,0.06);
    }
    .nav{
      max-width:var(--maxw);margin:0 auto;padding:12px 20px;display:flex;align-items:center;gap:16px;
    }
    .brand{display:flex;gap:12px;align-items:center;text-decoration:none;color:inherit}
    .logo-icon{
      width:44px;height:44px;border-radius:12px;display:grid;place-items:center;
      background:linear-gradient(135deg,var(--accent1),var(--accent2));
      color:white;font-weight:900;font-size:20px;box-shadow:0 6px 22px rgba(0,0,0,0.15)
    }
    .brand h1{font-size:20px;margin:0;font-weight:800;background:linear-gradient(135deg,var(--accent1),var(--accent2));-webkit-background-clip:text;color:transparent}
    .search-wrap{flex:1;max-width:640px;position:relative}
    .search-input{
      width:100%;padding:12px 48px;border-radius:999px;border:1px solid rgba(0,0,0,0.06);
      background:var(--surface);font-size:15px;box-shadow:0 6px 20px rgba(2,6,23,0.08);
      outline:none;transition:box-shadow .18s, border-color .18s;
    }
    .search-input:focus{box-shadow:0 10px 30px rgba(2,6,23,0.12);border-color:var(--accent1)}
    .search-icon{position:absolute;left:16px;top:50%;transform:translateY(-50%);font-size:16px;color:var(--muted)}
    .nav-actions{display:flex;gap:12px;align-items:center}
    .cta-btn{
      background:linear-gradient(135deg,var(--accent1),var(--accent2));
      color:white;border:none;padding:10px 18px;border-radius:999px;font-weight:700;cursor:pointer;box-shadow:0 8px 25px rgba(255,107,107,0.25)
    }

    /* Hamburger (categories drawer toggle) */
    .hamburger{
      width:46px;height:46px;border-radius:10px;display:grid;place-items:center;background:var(--surface);border:1px solid rgba(0,0,0,0.04);cursor:pointer;
    }

    /* Main layout */
    main{max-width:var(--maxw);margin:28px auto;padding:0 20px 80px;display:grid;grid-template-columns:1fr;gap:28px}
    .hero{display:flex;flex-direction:column;gap:18px;padding:36px;border-radius:var(--radius-lg);background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));backdrop-filter: blur(6px);}
    .hero h2{margin:0;font-size:40px;color:white;line-height:1.05;font-weight:900}
    .hero p{margin:0;color:rgba(255,255,255,0.9);font-size:16px}
    .hero .actions{display:flex;gap:12px;align-items:center;margin-top:6px}

    /* Categories slider (top-right drawer) */
    .categories-drawer{
      position:fixed;top:84px;right:20px;z-index:80;width:320px;max-width:85vw;padding:18px;border-radius:16px;
      background:linear-gradient(180deg,var(--glass),rgba(255,255,255,0.75));box-shadow:0 12px 45px rgba(15,23,42,0.2);
      transform:translateY(-10px);opacity:0;pointer-events:none;transition:all .22s ease;
      border:1px solid rgba(0,0,0,0.06)
    }
    .categories-drawer.open{transform:translateY(0);opacity:1;pointer-events:auto}
    .categories-grid{display:flex;flex-wrap:wrap;gap:10px}
    .cat-btn{padding:8px 12px;border-radius:999px;background:white;border:1px solid rgba(0,0,0,0.06);cursor:pointer;font-weight:600}

    /* Products grid */
    .products-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px}
    .product-card{background:var(--surface);border-radius:16px;padding:14px;border:1px solid rgba(2,6,23,0.04);box-shadow:0 12px 30px rgba(2,6,23,0.05);display:flex;flex-direction:column;gap:10px}
    .product-card img{width:100%;height:160px;object-fit:cover;border-radius:12px}
    .product-meta{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .product-title{font-weight:800;margin:0;font-size:16px}
    .product-desc{margin:0;color:var(--muted);font-size:13px}
    .product-actions{display:flex;gap:8px;align-items:center;margin-top:6px}
    .btn{padding:8px 12px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);cursor:pointer;background:#fff;font-weight:700}
    .btn-primary{background:linear-gradient(135deg,var(--accent1),var(--accent2));color:white;border:none}

    /* Empty state / results header */
    .results-head{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .muted{color:var(--muted)}

    footer{max-width:var(--maxw);margin:0 auto;padding:40px 20px 80px;color:white;text-align:center}
    footer .small{opacity:0.8;font-size:14px;margin-top:8px}

    /* Responsive */
    @media (max-width:900px){
      .nav{padding:10px 14px}
      .hero h2{font-size:28px}
      .categories-drawer{right:10px;left:10px;top:74px}
    }
  </style>
</head>
<body>

  <header class="site-header" aria-label="Top navigation">
    <nav class="nav" role="navigation">
      <a class="brand" href="#" aria-label="BoxWin home" onclick="scrollToTop(event)">
        <div class="logo-icon">ðŸ“¦</div>
        <h1>BoxWin</h1>
      </a>

      <div class="search-wrap" role="search">
        <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden>
          <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <input id="searchBar" class="search-input" type="search" placeholder="Search products, e.g. 'vitamin C serum' â€” press Enter" aria-label="Search products">
      </div>

      <div class="nav-actions" role="toolbar">
        <button class="hamburger" id="openCategories" title="Categories" aria-expanded="false" aria-controls="categoriesDrawer">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden>
            <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <button class="cta-btn" id="ctaShop">Start Shopping</button>
      </div>
    </nav>
  </header>

  <!-- categories drawer -->
  <aside id="categoriesDrawer" class="categories-drawer" aria-hidden="true">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
      <strong style="font-size:16px">Categories</strong>
      <button id="closeCategories" class="btn" aria-label="close categories">Close</button>
    </div>
    <div class="categories-grid" id="categoriesList">
      <!-- Buttons injected by JS -->
    </div>
    <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn" id="showAll">Show All</button>
      <button class="btn" id="shuffleProducts">Shuffle</button>
    </div>
  </aside>

  <main>
    <section class="hero" aria-labelledby="heroTitle">
      <div>
        <h2 id="heroTitle">Discover Amazing Products</h2>
        <p id="heroSubtitle">BoxWin is your go-to destination for discovering top-rated products and unbeatable deals across every category..</p>
      </div>
      <div class="actions">
        <button class="btn btn-primary" id="heroCTA">Browse Trending</button>
        <div class="muted" style="margin-left:auto">       </div>
      </div>
    </section>

    <section aria-live="polite" id="resultsSection">
      <div class="results-head" style="margin-bottom:12px">
        <div>
          <h3 id="resultsTitle" style="margin:0">Top Picks</h3>
          <div class="muted" id="resultsMeta">Showing curated products</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <span class="muted" id="resultCount">â€”</span>
        </div>
      </div>

      <div id="productsGrid" class="products-grid">
        <!-- product cards injected here -->
      </div>

      <div id="emptyState" style="display:none;margin-top:18px;padding:18px;border-radius:12px;background:rgba(255,255,255,0.9)">
        <strong>No results.</strong>
        <p class="muted" style="margin:6px 0 0">Try different keywords or remove category filters.</p>
      </div>
    </section>
  </main>

  <footer>
    <div style="font-weight:800;font-size:18px">Â© <span id="year"></span> BoxWin</div>
    <div class="small">  </div>
  </footer>

<script>
/*
  PRODUCTS DATA
  - Edit / add product objects here.
  - Each product should include: id, title, description, category, image (url or base64), affiliate_link
  - affiliate_link MUST be a fully qualified URL (https://...).
  - Example: { id: 'p1', title: 'Vitamin C Serum', category: 'Health & Beauty', ... }
*/
const products = [
  {
    id: 'p1',
    title: 'mitolyn',
    description: 'Mitolyn is a dietary supplement formulated to support mitochondrial health, boost energy levels, and promote healthy weight management by enhancing cellular metabolism..',
    category: 'Health & Beauty',
    price: '$49',
    image: 'https://raw.githubusercontent.com/appliink/apptry/main/Mitolyn_20251110_190046_0000.png',
    affiliate_link: 'https://dce4d8skzl2w5rejpfq70g1zas.hop.clickbank.net' // replace with your ClickBank link
  },
  {
    id: 'p2',
    title: 'Moon Elixir',
    description: 'The Ancient â€œMoonElixirâ€ Ritual is a natural approach designed to support feminine thyroid balance, boost energy, and restore hormonal harmony through time-honored herbal and lunar-inspired practices.',
    category: 'Health & Beauty',
    price: '$49',
    image: 'https://raw.githubusercontent.com/appliink/apptry/main/9b99a6ba-314d-4150-a6fe-0368095a788c.png',
    affiliate_link: 'https://36391j0f7gowarblrxu-ncqeme.hop.clickbank.net'
  },
  {
    id: 'p3',
    title: "brain training for dogs",
    description: 'Brain Training For Dogs is an online course by certified trainer Adrienne Farricelli that uses gentle, brain-stimulation games and step-by-step lessons to help dogs overcome behavioral problems and become more obedient. ',
    category: " ",
    price: '$67.00',
    image: 'https://raw.githubusercontent.com/appliink/apptry/main/Braindogtraining_20251110_211124_0000.png',
    affiliate_link: 'https://www.braintraining4dogs.com/get-btfd/?&shield=512487ye4fo53n1649r892p4zq'
  },
  {
    id: 'p4',
    title: 'Audifort',
    description: 'Audifort is a natural supplement designed to support ear health, reduce ringing, and promote clearer hearing.',
    category: "Health & Beauty",
    price: '$49',
    image: 'https://raw.githubusercontent.com/appliink/apptry/main/Audifort_20251110_213926_0000.png',
    affiliate_link: 'https://4de5di2c7cz78kc6z5u5tczu7n.hop.clickbank.net'
  },
  {
    id: 'p5',
    title: 'Yu sleep',
    description: 'Yu Sleep is an all-natural, nano-enhanced drop formula that claims to help you fall asleep faster, stay asleep through the night without waking up at 3 AM, and wake up feeling truly refreshed. ',
    category: 'Health & Beauty',
    price: '$39',
    image: 'https://raw.githubusercontent.com/appliink/apptry/main/Yu-Sleep-Reviews-2-compressed.jpg',
    affiliate_link: 'https://1d34a9q9xdwz3u4i4cpzfm4sef.hop.clickbank.net'
  },
  {
    id: 'p6',
    title: 'BioDentex',
    description: 'BioDentix is a natural supplement designed to support oral health by strengthening teeth, promoting healthier gums, and freshening breath.',
    category: 'Health & Beauty',
    price: '$49',
    image: 'https://raw.githubusercontent.com/appliink/apptry/main/ERROR%20404_20251110_171033_0000.png',
    affiliate_link: 'https://5cf22j-g2ky57t17nhk6whjv1j.hop.clickbank.net',
  },
  {
    id: 'p7',
    title: 'biodynamix',
    description: 'BioDynamix is a dietary supplement formulated to support joint health, improve flexibility, and relieve stiffness and discomfort associated with aging.',
    category: 'Health & Beauty',
    price: '$39',
    image: 'https://raw.githubusercontent.com/appliink/apptry/main/Bodynamix_20251111_023428_0000.png',
    affiliate_link: 'https://2e088frh5iv7eoa6tetej7yndi.hop.clickbank.net'
  },
  {
    id: 'p8',
    title: 'ProstaVive',
    description: 'ProstaVive is a natural dietary supplement designed to support prostate health, improve urinary flow, and enhance male vitality. ',
    category: 'Health & Beauty',
    price: '$39',
    image: 'https://raw.githubusercontent.com/appliink/apptry/main/ProstaVive_20251111_025359_0000.png',
    affiliate_link: 'https://5437djt7ud106oeeu83a74dr8a.hop.clickbank.net'
  },
  {
    id: 'p9',
    title: 'provadent',
    description: 'ProvaDent is a natural oralâ€‘health supplement designed to support gum strength, freshen breath, and promote a balanced mouth microbiome. ',
    category: 'Health & Beauty',
    price: '$49',
    image: 'https://raw.githubusercontent.com/appliink/apptry/main/Provadent_20251111_030708_0000.png',
    affiliate_link: 'https://e76c592jxko51n9ew965pzso0w.hop.clickbank.net'
  },
  {
    id: 'p10',
    title: 'Gluco6',
    description: 'Gluco6 is a plantâ€‘based supplement designed to support healthy blood sugar levels and glucose metabolism. ',
    category: 'Health & Beauty',
    price: '$39',
    image: 'https://raw.githubusercontent.com/appliink/apptry/main/Gluco_20251111_031604_0000.png',
    affiliate_link: 'https://4a850eyb3o293uc5znrahw4wa7.hop.clickbank.net'
  },
]

// --- UI state & elements
const productsGrid = document.getElementById('productsGrid');
const resultsTitle = document.getElementById('resultsTitle');
const resultsMeta = document.getElementById('resultsMeta');
const resultCount = document.getElementById('resultCount');
const emptyState = document.getElementById('emptyState');
const searchBar = document.getElementById('searchBar');
const categoriesList = document.getElementById('categoriesList');
const categoriesDrawer = document.getElementById('categoriesDrawer');
const openCategories = document.getElementById('openCategories');
const closeCategories = document.getElementById('closeCategories');
const showAll = document.getElementById('showAll');
const ctaShop = document.getElementById('ctaShop');
const heroCTA = document.getElementById('heroCTA');
const yearEl = document.getElementById('year');

yearEl.textContent = new Date().getFullYear();

// helper: unique categories
const categories = Array.from(new Set(products.map(p => p.category))).sort();

// render category buttons
function renderCategories(){
  categoriesList.innerHTML = '';
  categories.forEach(cat => {
    const btn = document.createElement('button');
    btn.className = 'cat-btn';
    btn.textContent = cat;
    btn.addEventListener('click', () => {
      applyFilter({category:cat});
      closeDrawer();
    });
    categoriesList.appendChild(btn);
  });
}
renderCategories();

// --- Search & filtering logic
let activeFilter = { category: null, q: null };
let lastRenderProducts = products.slice();

function normalize(text){ return (text||'').toString().trim().toLowerCase(); }

function filterProducts({q=null, category=null} = {}){
  activeFilter.q = q !== null ? q : activeFilter.q;
  activeFilter.category = category !== null ? category : activeFilter.category;

  const qNorm = normalize(activeFilter.q);
  let out = products.filter(p => {
    if (activeFilter.category && p.category !== activeFilter.category) return false;
    if (!qNorm) return true;
    // search title, desc, category
    const hay = normalize(p.title + ' ' + p.description + ' ' + p.category);
    return hay.includes(qNorm);
  });
  lastRenderProducts = out;
  renderProducts(out, qNorm);
  return out;
}

function renderProducts(list, qNorm=''){
  productsGrid.innerHTML = '';
  if (!list.length){
    emptyState.style.display = 'block';
    resultCount.textContent = '0 results';
    resultsMeta.textContent = 'No matching products';
    resultsTitle.textContent = qNorm ? `Search results for "${qNorm}"` : 'No results';
    return;
  }
  emptyState.style.display = 'none';
  resultsTitle.textContent = qNorm ? `Search results for "${qNorm}"` : 'Top Picks';
  resultsMeta.textContent = `${list.length} item${list.length>1 ? 's' : ''} found`;
  resultCount.textContent = `${list.length} results`;

  list.forEach(p => {
    const card = document.createElement('article');
    card.className = 'product-card';
    card.innerHTML = `
      <img loading="lazy" alt="${escapeHtml(p.title)}" src="${p.image}">
      <div>
        <div class="product-meta">
          <h4 class="product-title">${escapeHtml(p.title)}</h4>
          <div style="font-weight:800">${p.price || ''}</div>
        </div>
        <p class="product-desc">${escapeHtml(p.description)}</p>
        <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap" class="product-actions">
          <button class="btn" data-id="${p.id}" onclick="openDetails('${p.id}')">Details</button>
          <a class="btn btn-primary" href="${p.affiliate_link || '#'}" target="_blank" rel="noopener noreferrer" onclick="trackAffiliate('${p.id}')">Buy now</a>
          <span style="margin-left:auto;font-size:12px;color:var(--muted)">${escapeHtml(p.category)}</span>
        </div>
      </div>
    `;
    productsGrid.appendChild(card);
  });
}

// small helper - escape HTML
function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

// initial render (randomized to feel dynamic)
renderProducts(shuffleArray(products).slice(0,6));

// search behavior
searchBar.addEventListener('keypress', function(e){
  if (e.key === 'Enter'){
    const q = this.value.trim();
    if (q.length === 0) return applyFilter({q: null});
    applyFilter({q});
    // update url so user can share results
    const u = new URL(location.href);
    u.searchParams.set('q', q);
    history.replaceState({}, '', u);
  }
});

// apply filter helper
function applyFilter(opts){
  filterProducts(opts);
}

// support query param on load
function initFromQuery(){
  const url = new URL(location.href);
  const q = url.searchParams.get('q');
  if (q){
    searchBar.value = q;
    applyFilter({q});
    openResultsSection();
  } else {
    // default top picks: first 6
    renderProducts(products);
  }
}
initFromQuery();

// categories drawer behavior
openCategories.addEventListener('click', toggleDrawer);
closeCategories.addEventListener('click', closeDrawer);
showAll.addEventListener('click', () => {
  activeFilter = {category: null, q: null};
  searchBar.value = '';
  renderProducts(products.slice(0,8));
  closeDrawer();
});

function toggleDrawer(){
  const open = categoriesDrawer.classList.toggle('open');
  categoriesDrawer.setAttribute('aria-hidden', String(!open));
  openCategories.setAttribute('aria-expanded', String(open));
}
function closeDrawer(){ categoriesDrawer.classList.remove('open'); categoriesDrawer.setAttribute('aria-hidden', 'true'); openCategories.setAttribute('aria-expanded','false'); }

// CTA & Hero button behavior
ctaShop.addEventListener('click', () => { openDrawer(); });
heroCTA.addEventListener('click', () => { scrollToResults(); renderProducts(shuffleArray(products).slice(0,8)); });

// open drawer helper
function openDrawer(){ if (!categoriesDrawer.classList.contains('open')) toggleDrawer(); }

// scroll helpers
function scrollToResults(){ document.getElementById('resultsSection').scrollIntoView({behavior:'smooth'}); }
function scrollToTop(e){ if (e) e.preventDefault(); window.scrollTo({top:0,behavior:'smooth'}); }
function openDetails(id){
  const p = products.find(x=>x.id===id);
  if (!p) return alert('Product not found');
  // simple details modal using confirm (lightweight). Replace with real modal when needed.
  const more = `${p.title}\n\n${p.description}\n\nPrice: ${p.price || 'â€”'}\nCategory: ${p.category}\n\nOpen affiliate link?`;
  if (confirm(more)){
    window.open(p.affiliate_link || '#','_blank','noopener');
  }
}

// analytics placeholder (you can integrate real analytics)
function trackAffiliate(id){
  console.log('Affiliate click', id, new Date().toISOString());
  // you may insert tracking pixel, fetch to server, or other logic here
}

// small utilities
function shuffleArray(arr){
  const out = arr.slice();
  for (let i = out.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [out[i], out[j]] = [out[j], out[i]];
  }
  return out;
}

// simple keyboard shortcut: "/" to focus search
window.addEventListener('keydown', (e)=>{
  if (e.key === '/' && document.activeElement !== searchBar){
    e.preventDefault();
    searchBar.focus();
  }
});

// click outside drawer to close
document.addEventListener('click', (e)=>{
  if (!categoriesDrawer.contains(e.target) && !openCategories.contains(e.target)){
    closeDrawer();
  }
});

// tiny UI: shuffle button
document.getElementById('shuffleProducts').addEventListener('click', ()=>{
  renderProducts(shuffleArray(products).slice(0,8));
});

// If user clicks back/forward updating q param, reflect in UI
window.addEventListener('popstate', ()=>{ initFromQuery(); });

// helper: open drawer (used by CTA)
function openDrawer(){ if (!categoriesDrawer.classList.contains('open')) categoriesDrawer.classList.add('open'); categoriesDrawer.setAttribute('aria-hidden','false'); openCategories.setAttribute('aria-expanded','true'); }

// Utility: open results when search used
function openResultsSection(){ document.getElementById('resultsSection').scrollIntoView({behavior:'smooth'}); }

// Accessibility: ensure main landmarks
document.querySelector('main').setAttribute('role','main');

// Preload images (optional small set)
function preloadImages(){
  products.slice(0,4).forEach(p=>{
    const img = new Image();
    img.src = p.image;
  });
}
preloadImages();

</script>

</body>
</html>
</body>
</html>
